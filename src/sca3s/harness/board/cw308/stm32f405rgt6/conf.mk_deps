# Copyright (C) 2018 SCARV project <info@scarv.org>
#
# Use of this source code is restricted per the MIT license, a copy of which 
# can be found at https://opensource.org/licenses/MIT (or should be included 
# as LICENSE.txt within the associated archive or repository).

# =============================================================================

DEPS_INCLUDES += ${DEPS}/chipwhisperer/hardware/victims/firmware/hal/stm32f4
DEPS_INCLUDES += ${DEPS}/chipwhisperer/hardware/victims/firmware/hal/stm32f4/CMSIS
DEPS_INCLUDES += ${DEPS}/chipwhisperer/hardware/victims/firmware/hal/stm32f4/CMSIS/core
DEPS_INCLUDES += ${DEPS}/chipwhisperer/hardware/victims/firmware/hal/stm32f4/CMSIS/device
DEPS_INCLUDES += ${DEPS}/chipwhisperer/hardware/victims/firmware/hal/stm32f4/Legacy

DEPS_SOURCES  += ${DEPS}/chipwhisperer/hardware/victims/firmware/hal/stm32f4/stm32f4_startup.S
DEPS_SOURCES  += ${DEPS}/chipwhisperer/hardware/victims/firmware/hal/stm32f4/stm32f4_hal.c 
DEPS_SOURCES  += ${DEPS}/chipwhisperer/hardware/victims/firmware/hal/stm32f4/stm32f4_hal_lowlevel.c 

DEPS_OBJECTS  += $(patsubst %.c, %.o, $(filter %.c, ${DEPS_SOURCES}))
DEPS_OBJECTS  += $(patsubst %.S, %.o, $(filter %.S, ${DEPS_SOURCES}))
DEPS_OBJECTS  += $(patsubst %.s, %.o, $(filter %.s, ${DEPS_SOURCES}))

${DEPS}/chipwhisperer/hardware/victims/firmware/hal/%.o : ${DEPS}/chipwhisperer/hardware/victims/firmware/hal/%.c 
	@${GCC_PREFIX}gcc $(patsubst %, -I %, ${DEPS_INCLUDES}) ${GCC_PATHS} ${GCC_FLAGS} -c -o ${@} ${<}
${DEPS}/chipwhisperer/hardware/victims/firmware/hal/%.o : ${DEPS}/chipwhisperer/hardware/victims/firmware/hal/%.S
	@${GCC_PREFIX}gcc $(patsubst %, -I %, ${DEPS_INCLUDES}) ${GCC_PATHS} ${GCC_FLAGS} -c -o ${@} ${<}
${DEPS}/chipwhisperer/hardware/victims/firmware/hal/%.o : ${DEPS}/chipwhisperer/hardware/victims/firmware/hal/%.s
	@${GCC_PREFIX}gcc $(patsubst %, -I %, ${DEPS_INCLUDES}) ${GCC_PATHS} ${GCC_FLAGS} -c -o ${@} ${<}

# -----------------------------------------------------------------------------

deps-fetch :
	@git clone https://github.com/newaetech/chipwhisperer.git ${DEPS}/chipwhisperer

deps-build :

deps-clean : 

# =============================================================================
